type: kostalpiko
name: Kostal Piko + Piko BA
params:
- name: usage
  choice: [ "grid", "pv" ]
- name: host
  default: 192.0.2.2
  hint: ip address or host name
render: |
  type: custom
  power:
  {{- if eq .usage "grid" }}
    # Grid
    source: calc
    add:
    - source: http
      uri: http://{{ .host }}/api/dxs.json?dxsEntries=67109120 # PV AC Ausgang
      jq: .dxsEntries[0].value
      scale: -1.0
    - source: http
      uri: http://{{ .host }}/api/dxs.json?dxsEntries=83886848 # Netzbezug
      jq: .dxsEntries[0].value
    - source: http
      uri: http://{{ .host }}/api/dxs.json?dxsEntries=83886336 # PV Eigenverbrauch
      jq: .dxsEntries[0].value
  {{- end -}}
  {{- if eq .usage "pv" }}
    # PV
    source: http
    uri: http://{{ .host }}/api/dxs.json?dxsEntries=67109120 # PV AC Ausgang
    jq: .dxsEntries[0].value
  {{- end -}}
